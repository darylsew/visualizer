<!DOCTYPE html>

<style>
  canvas { width: 100%; height:100%; border-style: solid; }
</style>

<body>
<script src="../static/js/jquery.js"></script>
<script src="../static/three.min.js"></script>

<script>
  
  var scene, camera, renderer;
  var geometry, material, cube;
  var planeGeometry, planeMaterial, plane;
  var light;
  var scene_WID, scene_HT;
  var centroids, curated_centroids, volumes, curated_volumes;

  init();
  curate();

  function init() {
    /* Camera */
    scene_WID = window.innerWidth;
    scene_HT = window.innerHeight;
    camera = new THREE.PerspectiveCamera(75, scene_WID/scene_HT, 0.1, 1000);
    camera.position.z = 1.5;

    /* Cube */
    geometry = new THREE.CubeGeometry(1,1,1);
    material = new THREE.MeshLambertMaterial({ color: 0xff0000} );
    cube = new THREE.Mesh(geometry, material);

    /* Plane */
    planeGeometry = new THREE.PlaneGeometry(250,250,5,5);
    planeMaterial = new THREE.MeshPhongMaterial({ color: 0xf0f0f0 });
    plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.position.z = -21;

    /* Light */
    light = new THREE.PointLight(0xFFFFFF);

    /* Additions */
    scene = new THREE.Scene();
    scene.add(cube);
    scene.add(plane);
    scene.add(light);
    light.position.z = 1.5;
    renderer = new THREE.CanvasRenderer();
    renderer.setSize(scene_WID, scene_HT);
    document.body.appendChild(renderer.domElement);
  }

  function curate() {
    /* curated_centroids will be full of values that
       are meaningful to the color of the cube. */
    centroids = {{centroids}};
    curated_centroids = new Array(centroids.length * 2);
    for (var i = 0; i<centroids.length; i++) {
      curated_centroids[2 * i] = centroids[i];
    }
    for (var i = 0; i<curated_centroids.length; i++) { // convert to 60fps
      curated_centroids[i] = curated_centroids[i-i%2] * 0xffffff;
    }

    /* curated_volumes will fall in the range [-0.5,0.5] and later
       affect camera position and therefore apparent cube size. */
    volumes = {{volumes}};
    curated_volumes = new Array(volumes.length * 2);
    for (var i = 0; i<volumes.length; i++) {
        curated_volumes[2 * i] = volumes[i] * 0.5 - 0.25;
				      //shift to and scale to -.25 ~ .25
    }
    for (var i = 0; i<curated_volumes.length; i++) {
        curated_volumes[i] = curated_volumes[i-i%2];
    }
  }

  var index = 0;
  function render() {
    requestAnimationFrame(render);
    renderer.render(scene,camera);
    cube.material.color.setHex(curated_centroids[index]);
    camera.position.z = 1.5 - curated_volumes[index];
                       //distance is inversely proportional to apparent size
    index = (index + 1) % curated_centroids.length;
    cube.rotation.x = Math.cos(index/50);
    cube.rotation.y = Math.sin(index/50);
  }


  render();


</script>

</body>
</html>
